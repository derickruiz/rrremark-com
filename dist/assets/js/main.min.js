"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var config={apiKey:"AIzaSyCfilMPI3GT5ujZPcowVwHFIaknVa3uc3U",authDomain:"rrremark-7fa66.firebaseapp.com",databaseURL:"https://rrremark-7fa66.firebaseio.com",storageBucket:"rrremark-7fa66.appspot.com",messagingSenderId:"27202409223"};firebase.initializeApp(config);var database=firebase.database(),DATABASE={getProjects:function(a){var b=[];firebase.auth().onAuthStateChanged(function(c){c&&firebase.database().ref("projectList/"+c.uid).on("value",function(c){b=[],c.forEach(function(a){var c=a.val();c.key=a.getKey(),b.push(c)}),a(b)})})},getSingleProject:function(a,b){var c=firebase.auth().currentUser.uid;c&&firebase.database().ref("projects/"+c+"/"+a).once("value",function(c){var d=c.val();d.key=c.key,d.intentions.forEach(function(a){"undefined"==typeof a.note.isEditing&&(a.note.isEditing=!1),"undefined"==typeof a.todos?a.todos=[]:a.todos.forEach(function(a){a.isEditing=!1})}),b(d),DATABASE.setDefaultProject(a)})},createProject:function(a,b){firebase.auth().onAuthStateChanged(function(a){if(a){var c=firebase.database().ref("/projects/"+a.uid).push();b(c)}})},setDefaultProject:function(a){var b=firebase.auth().currentUser.uid,c=_defineProperty({},"defaultProjects/"+b,a);firebase.database().ref().update(c)},getDefaultProject:function(a){var b=firebase.auth().currentUser.uid;firebase.database().ref("defaultProjects/"+b).once("value",function(b){b.val()&&""!==b.val()?DATABASE.getSingleProject(b.val(),a):a(!1)})},updateProjectTitle:function(a,b,c){var d,e=firebase.auth().currentUser.uid,f=(d={},_defineProperty(d,"projectList/"+e+"/"+a+"/title",b),_defineProperty(d,"projects/"+e+"/"+a+"/title",b),d);return firebase.database().ref().update(f,c)},updateIntentionNote:function(a,b,c,d){var e=firebase.auth().currentUser.uid,f=_defineProperty({},"projects/"+e+"/"+a+"/intentions/"+b+"/note/text",c);return firebase.database().ref().update(f,d)},replaceTodos:function(a,b,c,d){var e,f=firebase.auth().currentUser.uid,g=0,h=0;c.forEach(function(a){a.isCompleted?h+=1:g+=1});var i=(e={},_defineProperty(e,"projects/"+f+"/"+a+"/intentions/"+b+"/todos",c),_defineProperty(e,"projects/"+f+"/"+a+"/completedTodos",h),_defineProperty(e,"projectList/"+f+"/"+a+"/completedTodos",h),_defineProperty(e,"projects/"+f+"/"+a+"/unCompletedTodos",g),_defineProperty(e,"projectList/"+f+"/"+a+"/unCompletedTodos",g),e);return firebase.database().ref().update(i,d)},loginInUser:function(a,b,c){firebase.auth().signInWithEmailAndPassword(a,b).catch(function(a){c(a.message)})},signUpUser:function(a,b,c){firebase.auth().createUserWithEmailAndPassword(a,b).catch(function(a){c(a.message)})}};firebase.auth().onAuthStateChanged(function(a){a||(window.location="login.html")}),function(){function a(){var a=document.body.scrollTop;Math.abs(c-a)<=d||(a>c&&a>e?document.querySelector(".js-menu").classList.add("Menu--hidden"):document.querySelector(".js-menu").classList.remove("Menu--hidden"),c=a)}var b,c=0,d=5,e=document.querySelector(".js-menu").offsetHeight;window.addEventListener("scroll",function(a){b=!0}),setInterval(function(){b&&(a(),b=!1)},250)}();var UTILS={isUndefined:function(a){return"undefined"==typeof a},autoSizeAndFocus:function(a){autosize(a),Vue.nextTick(function(){return a.focus()})},swapArrayElements:function(a,b,c){var d=a,e=d[b];return d[b]=d[c],d[c]=e,d}},INDIVIDUAL_PROJECT={title:"Another Test Project Title",unCompletedTodos:8,completedTodos:12,totalTime:16,intentions:[{note:{text:"Here’s some text that I’ve concerning what I think about a todo and also probably how to go ahead and complete it. Here’s a bit more text just to make it dramatic.\n\nNow I’m skipping places and this is probably where I’ll stop.",isEditing:!1},todos:[{text:"A todo you need to complete and haven't completed yet.",isCompleted:!1},{text:"A todo you've already completed.",isCompleted:!0}]}]},BLANK_PROJECT={title:"",unCompletedTodos:0,completedTodos:0,totalTime:0,intentions:[{note:{text:"",isEditing:!1},todos:[]}]},PROJECT_LIST=[{title:"A big project name",unCompletedTodos:5,completedTodos:10,totalTime:95},{title:"Content Creator Delete Site and Transfer Assets",unCompletedTodos:5,completedTodos:10,totalTime:95}];!function(){var a={HANDLER:"_vue_click_outside_handler",bind:function(b,c){a.unbind(b);var d=!1;setTimeout(function(){d=!0},0),b[a.HANDLER]=function(a){var e=b.contains(a.target);d&&a.target!=b&&!e&&c.value(a)},document.documentElement.addEventListener("click",b[a.HANDLER],!1)},unbind:function(b){document.documentElement.removeEventListener("click",b[a.HANDLER],!1)}};Vue.directive("click-outside",a),Vue.component("todos",{template:"#vue_tmpl_todos",props:{todos:{type:Array,required:!0},intentionIndex:{type:Number,required:!0}},mounted:function(){var a=this,b=void 0,c=void 0;dragula([this.$el],{revertOnSpill:!0,moves:function(a,b,c){return c.classList.contains("Todo-drag")}}).on("over",function(a,c){c.classList.add("Todos--dragging"),a.style.opacity=1,b=Array.prototype.indexOf.call(c.children,a)}).on("out",function(d,e){e.className=e.className.replace("Todos--dragging",""),d.style.opacity=null,c=Array.prototype.indexOf.call(e.children,d),b!==c&&a.$emit("reorder-todos",a.intentionIndex,b,c)})}}),Vue.component("todo",{template:"#vue_tmpl_todo",props:{value:{type:Object,required:!0},index:{type:Number}},data:function(){return{readyToDrag:!1}},methods:{checkTodo:function(a,b){var c=this,d=this.value;a?(d.isEditing=!1,d.text=b,this.$emit("input",d),Vue.nextTick(function(){c.$emit("save-todos")})):this.removeTodo(this.index)},editTodo:function(){var a=this.value;a.isEditing=!0,this.previousCompleteStatus=a.isCompleted,this.previousValue=a.text,a.isCompleted=!1,this.$emit("input",a)},removeTodo:function(a){this.$emit("remove-todo",a)},checkTodoCompleteStatus:function(a){var b=this.value;this.previousCompleteStatus=b.isCompleted,this.$emit("save-todos")},stopEditingTodo:function(){var a=this,b=this.value;""!==b.text?(b.isEditing=!1,b.text===this.previousValue&&(b.isCompleted=this.previousCompleteStatus),this.$emit("input",b),Vue.nextTick(function(){a.$emit("save-todos")})):this.removeTodo(this.index)}}}),Vue.component("editable",{template:"#vue_tmpl_editable",props:{value:{type:String,required:!0},editFlag:{type:Boolean,required:!0},maxlength:{type:Number,required:!1,default:60}},mounted:function(){this.editFlag&&(UTILS.autoSizeAndFocus(this.$el),autosize.update(this.$el))},updated:function(){this.editFlag&&(UTILS.autoSizeAndFocus(this.$el),autosize.update(this.$el))},methods:{nonEditableClickHandler:function(a){this.$emit("non-editable-click")},editableKeyUpHandler:function(a){13===a.keyCode&&(this.$el.value&&""!==this.$el.value.trim()?this.$emit("editable-key-up",!0):this.$emit("editable-key-up",!1)),this.$emit("input",this.$el.value.trim())}}}),Vue.component("note",{template:"#vue_tmpl_note",props:{value:{type:Object,required:!0},placeholder:{type:String,required:!0}},computed:{splicedNotes:function(){var a=this.value;return a.text.split("\n\n")}},data:function(){return{numTimesPressedEnter:0,pressedBackSpaceOnLastChar:!1}},mounted:function(){var a=this.value;a.isEditing&&UTILS.autoSizeAndFocus(this.$el)},updated:function(){var a=this.value;a.isEditing&&UTILS.autoSizeAndFocus(this.$el)},methods:{isBlank:function(){var a=this.value;return""===a.text},editNote:function(a){var b=this.value;b.isEditing=!0,this.$emit("input",b)},stopEditing:function(a){var b=this.value;b.isEditing=!1,this.$emit("input",b)},updateNote:function(a){var b=this.value;return b.text=a.target.value.trim(),8===a.keyCode&&1===b.text.length?(b.text="",void this.$emit("input",b)):(13===a.keyCode?this.numTimesPressedEnter+=1:this.numTimesPressedEnter=0,this.numTimesPressedEnter>=3&&(b.isEditing=!1,b.text=a.target.value.split("\n\n\n")[0].trim(),this.numTimesPressedEnter=0,this.$emit("save-note",b)),void this.$emit("input",b))},stopEditingNote:function(){var a=this.value;""!==a.text&&(a.isEditing=!1,a.text=a.text.split("\n\n\n")[0].trim(),this.numTimesPressedEnter=0,this.$emit("save-note",a))}}});var b=new Vue;new Vue({el:"#vue_menu",data:{isExpanded:!1,projects:[]},created:function(){var a=this;DATABASE.getProjects(function(b){a.projects=b})},methods:{expandMenu:function(){this.isExpanded=!this.isExpanded},isNotLast:function(a){var b=this.projects.length-1===a;return!b},loadProject:function(a){var c=this;DATABASE.getSingleProject(this.projects[a].key,function(a){b.$emit("get-project",a),c.expandMenu()})}}}),new Vue({el:"#vue_project",data:{project:BLANK_PROJECT,showProjectStats:!0,editingProjectTitle:!0},created:function(){var a=this;this.isProjectEmpty()&&(this.showProjectStats=!1,this.editingProjectTitle=!0,this.$forceUpdate()),this.$on("remove-empty-intentions",this.removeEmptyIntentions),b.$on("get-project",function(b){a.project=b,a.editingProjectTitle=!1})},methods:{addTodo:function(a){var b=this.project.intentions[a].todos;this.project.intentions[a].note.isEditing=!1,b.length>=1&&""===b[b.length-1].text&&this.removeTodo(a,b.length-1),this.project.intentions[a].todos.push({text:"",isCompleted:!1,isEditing:!0})},removeTodo:function(a,b){this.project.intentions[a].todos.splice(b,1),this.$emit("remove-empty-intentions")},saveTodos:function(a){DATABASE.replaceTodos(this.project.key,a,this.project.intentions[a].todos,function(){})},reorderTodos:function(a,b,c){this.project.intentions[a].todos=UTILS.swapArrayElements(this.project.intentions[a].todos,b,c),this.saveTodos(a)},addIntention:function(a){this.isIntentionLast(a)?this.project.intentions.push({note:{text:"",isEditing:!0},todos:[]}):this.project.intentions.splice(a+1,0,{note:{text:"",isEditing:!0},todos:[]})},removeIntention:function(a){this.project.intentions.splice(a,1)},calculateNotePlaceHolderMessage:function(){return this.isProjectEmpty()?"Define the approach to the project by writing some notes":"Add another note"},saveIntentionNote:function(a,b){DATABASE.updateIntentionNote(this.project.key,a,this.project.intentions[a].note.text)},isIntentionNoteEmpty:function(a){return""===this.project.intentions[a].note.text},isIntentionLast:function(a){return a+1===this.project.intentions.length},isIntentionEmpty:function(a){return this.isIntentionNoteEmpty(a)&&0===this.project.intentions[a].todos.length},isProjectEmpty:function(){return this.isIntentionLast(0)&&this.isIntentionEmpty(0)&&this.isIntentionNoteEmpty(0)},intentionHasTodos:function(a){return this.project.intentions[a].todos&&this.project.intentions[a].todos.length>=1},hasAtLeastOneTodo:function(a){var b=this.project.intentions[a].todos;return 1===b.length?b&&1===b.length&&""!==b[0].text:0!==b.length&&(b.length>1||void 0)},removeEmptyIntentions:function(){if(this.project.intentions.length>=2)for(var a=0;a<this.project.intentions.length;a+=1)""===this.project.intentions[a].note.text&&0===this.project.intentions[a].todos.length&&this.removeIntention(a)},checkProjectTitle:function(a){var b=this;a&&(this.editingProjectTitle=!1,this.project.key?DATABASE.updateProjectTitle(this.project.key,this.project.title):DATABASE.createProject(this.project.title,function(a){a&&(b.project.key=a.key,DATABASE.updateProjectTitle(b.project.key,b.project.title))}),this.isProjectEmpty()&&(this.project.intentions[0].note.isEditing=!0))},editProjectTitle:function(){this.editingProjectTitle=!0},stopEditingProjectTitle:function(){""!==this.project.title&&(this.editingProjectTitle=!1)}}})}();